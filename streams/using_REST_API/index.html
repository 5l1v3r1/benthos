<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Ashley Jeffs">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>using REST API - Benthos</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai.min.css">
        <link href="../../style/blobfish.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-135959729-3', 'docs.benthos.dev');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
  <a class="navbar-brand" href="https://www.benthos.dev">Benthos</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="/">Home</a>
                            </li>
                            <li >
                                <a href="../../cookbooks/">Cookbooks</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Components <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../inputs/">Inputs</a>
</li>
                                    
<li >
    <a href="../../buffers/">Buffers</a>
</li>
                                    
<li >
    <a href="../../processors/">Processors</a>
</li>
                                    
<li >
    <a href="../../conditions/">Conditions</a>
</li>
                                    
<li >
    <a href="../../outputs/">Outputs</a>
</li>
                                    
<li >
    <a href="../../caches/">Caches</a>
</li>
                                    
<li >
    <a href="../../rate_limits/">Rate Limits</a>
</li>
                                    
<li >
    <a href="../../metrics/">Metrics</a>
</li>
                                    
<li >
    <a href="../../tracers/">Tracers</a>
</li>
                                    
<li >
    <a href="../../logger/">Logger</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../getting_started/">Getting Started</a>
</li>
                                    
<li >
    <a href="../../serverless/">Serverless</a>
</li>
                                    
<li >
    <a href="../../configuration/">Configuration</a>
</li>
                                    
<li >
    <a href="../../config_interpolation/">Config Interpolation</a>
</li>
                                    
<li >
    <a href="../../pipeline/">Processing Pipelines</a>
</li>
                                    
<li >
    <a href="../../batching/">Message Batching</a>
</li>
                                    
<li >
    <a href="../../error_handling/">Error Handling</a>
</li>
                                    
<li >
    <a href="../../performance_tuning/">Performance Tuning</a>
</li>
                                    
<li >
    <a href="../../monitoring/">Monitoring</a>
</li>
                                    
<li >
    <a href="../../sync_responses/">Synchronous Responses</a>
</li>
                                    
<li >
    <a href="../../workflows/">Workflows</a>
</li>
                                    
<li >
    <a href="../">Streams Mode</a>
</li>
                                    
<li >
    <a href="../../examples/">Applied Examples</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
    <li class="nav-item">
      <a href="https://github.com/Jeffail/benthos/" class="nav-link">
        <i class="fa fa-github"></i> Code
      </a>
    </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#streams-via-rest-api">Streams Via REST API</a></li>
            <li><a href="#walkthrough">Walkthrough</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="streams-via-rest-api">Streams Via REST API</h1>
<p>By using the Benthos <code>--streams</code> mode REST API you can dynamically control which
streams are active at runtime. The full spec for the Benthos streams mode REST
API can be <a href="../../api/streams/">found here</a>.</p>
<p>Note that stream configs created and updated using this API do <em>not</em> benefit
from [environment variable interpolation][interpolation] (function interpolation
will still work).</p>
<h2 id="walkthrough">Walkthrough</h2>
<p>Start by running Benthos in streams mode:</p>
<pre><code class="bash">$ benthos --streams
</code></pre>

<p>On a separate terminal we can add our first stream <code>foo</code> by <code>POST</code>ing a JSON or
YAML config to the <code>/streams/foo</code> endpoint:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams/foo -X POST --data-binary @- &lt;&lt;EOF
input:
  type: http_server
buffer:
  type: memory
pipeline:
  threads: 4
  processors:
  - type: jmespath
    jmespath:
      query: &quot;{id: user.id, content: body.content}&quot;
output:
  type: http_server
EOF
</code></pre>

<p>Now we can check the full set of streams loaded by <code>GET</code>ing the <code>/streams</code>
endpoint:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams | jq '.'
{
  &quot;foo&quot;: {
    &quot;active&quot;: true,
    &quot;uptime&quot;: 7.223545951,
    &quot;uptime_str&quot;: &quot;7.223545951s&quot;
  }
}
</code></pre>

<p>Good, now let's add another stream <code>bar</code> the same way:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams/bar -X POST --data-binary @- &lt;&lt;EOF
input:
  type: kafka
  kafka:
    addresses:
    - localhost:9092
    topic: my_topic
buffer:
  type: none
pipeline:
  threads: 1
  processors:
  - type: sample
    sample:
      retain: 10
output:
  type: elasticsearch
  elasticsearch:
    urls:
    - http://localhost:9200
EOF
</code></pre>

<p>And check the set again:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams | jq '.'
{
  &quot;bar&quot;: {
    &quot;active&quot;: true,
    &quot;uptime&quot;: 10.121344484,
    &quot;uptime_str&quot;: &quot;10.121344484s&quot;
  },
  &quot;foo&quot;: {
    &quot;active&quot;: true,
    &quot;uptime&quot;: 19.380582951,
    &quot;uptime_str&quot;: &quot;19.380583306s&quot;
  }
}
</code></pre>

<p>It's also possible to get the configuration of a loaded stream by <code>GET</code>ing the
path <code>/streams/{id}</code>:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams/foo | jq '.'
{
  &quot;active&quot;: true,
  &quot;uptime&quot;: 30.123488951,
  &quot;uptime_str&quot;: &quot;30.123488951s&quot;
  &quot;config&quot;: {
    &quot;input&quot;: {
      &quot;type&quot;: &quot;http_server&quot;,
      &quot;http_server&quot;: {
        &quot;address&quot;: &quot;&quot;,
        &quot;cert_file&quot;: &quot;&quot;,
        &quot;key_file&quot;: &quot;&quot;,
        &quot;path&quot;: &quot;/post&quot;,
        &quot;timeout&quot;: &quot;5s&quot;
      }
    },
    &quot;buffer&quot;: {
      &quot;type&quot;: &quot;memory&quot;,
      &quot;memory&quot;: {
        &quot;limit&quot;: 10000000
      }
    },
    ... etc ...
  }
}
</code></pre>

<p>Next, we might want to update stream <code>foo</code> by <code>PUT</code>ing a new config to the path
<code>/streams/foo</code>:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams/foo -X PUT --data-binary @- &lt;&lt;EOF
input:
  type: http_server
buffer:
  type: none
pipeline:
  threads: 4
  processors:
  - type: jmespath
    jmespath:
      query: &quot;{id: user.id, content: body.content}&quot;
output:
  type: http_server
EOF
</code></pre>

<p>We have removed the memory buffer with this change, let's check that the config
has actually been updated:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams/foo | jq '.'
{
  &quot;active&quot;: true,
  &quot;uptime&quot;: 12.328482951,
  &quot;uptime_str&quot;: &quot;12.328482951s&quot;
  &quot;config&quot;: {
    &quot;input&quot;: {
      &quot;type&quot;: &quot;http_server&quot;,
      &quot;http_server&quot;: {
        &quot;address&quot;: &quot;&quot;,
        &quot;cert_file&quot;: &quot;&quot;,
        &quot;key_file&quot;: &quot;&quot;,
        &quot;path&quot;: &quot;/post&quot;,
        &quot;timeout&quot;: &quot;5s&quot;
      }
    },
    &quot;buffer&quot;: {
      &quot;type&quot;: &quot;none&quot;
    },
    ... etc ...
  }
}
</code></pre>

<p>Good, we are done with stream <code>bar</code> now, so let's delete it by <code>DELETE</code>ing the
<code>/streams/bar</code> endpoint:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams/bar -X DELETE
</code></pre>

<p>And let's <code>GET</code> the <code>/streams</code> endpoint to see the new set:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams | jq '.'
{
  &quot;foo&quot;: {
    &quot;active&quot;: true,
    &quot;uptime&quot;: 31.872448851,
    &quot;uptime_str&quot;: &quot;31.872448851s&quot;
  }
}
</code></pre>

<p>Great. Another useful feature is <code>POST</code>ing to <code>/streams</code>, this allows us to set
the entire set of streams with a single request.</p>
<p>The payload is a map of stream ids to configurations and this will become the
exclusive set of active streams. If there are existing streams that are not on
the list they will be removed.</p>
<pre><code class="bash">$ curl http://localhost:4195/streams -X POST --data-binary @- &lt;&lt;EOF
bar:
  input:
    type: http_client
    http_client:
      url: http://localhost:4195/baz/get
  output:
    type: stdout
baz:
  input:
    type: http_server
  output:
    type: http_server
EOF
</code></pre>

<p>Let's check our new set of streams:</p>
<pre><code class="bash">$ curl http://localhost:4195/streams | jq '.'
{
  &quot;bar&quot;: {
    &quot;active&quot;: true,
    &quot;uptime&quot;: 3.183883444,
    &quot;uptime_str&quot;: &quot;3.183883444s&quot;
  },
  &quot;baz&quot;: {
    &quot;active&quot;: true,
    &quot;uptime&quot;: 3.183883449,
    &quot;uptime_str&quot;: &quot;3.183883449s&quot;
  }
}
</code></pre>

<p>Done.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
